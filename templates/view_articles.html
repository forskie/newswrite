<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{ article.title }} - NewsWrite Pro</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
  body { font-family: 'Roboto', sans-serif; }
  .article-content { line-height: 1.8; }
  .article-content p { margin-bottom: 1.5em; }
  .article-content h1, .article-content h2, .article-content h3 { font-weight: bold; margin: 1.5em 0 0.5em 0; }
  .article-content blockquote { border-left: 4px solid #6366f1; padding-left: 1.5em; font-style: italic; color: #9ca3af; margin: 1.5em 0; }
  .article-content a { color: #60a5fa; text-decoration: underline; }
  .article-content a:hover { color: #93c5fd; }
</style>
</head>
<body class="bg-gray-950 text-gray-200 min-h-screen flex flex-col">

<!-- Header -->
<header class="bg-gray-900 border-b border-gray-800">
  <div class="container mx-auto px-6 py-4 flex justify-between items-center">
    <a href="{{ url_for('home_page_logged') }}" class="text-xl font-bold text-indigo-400 hover:text-indigo-300">NewsWrite Pro</a>
    <div class="flex items-center space-x-4">
      <a href="{{ url_for('my_articles') }}" class="px-4 py-2 bg-gray-800 border border-gray-700 text-gray-300 rounded hover:border-indigo-500 hover:text-indigo-400 transition">‚Üê –í—Å–µ —Å—Ç–∞—Ç—å–∏</a>
      {% if session.get('user_id') == article.author_id %}
      <a href="{{ url_for('edit_article', id=article.id) }}" class="px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 transition">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
      <button onclick="confirmDelete()" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition">–£–¥–∞–ª–∏—Ç—å</button>
      {% endif %}
    </div>
  </div>
</header>

<!-- Main content -->
<main class="flex-grow container mx-auto px-6 py-10 max-w-4xl">

  <!-- Flash messages -->
  {% with messages = get_flashed_messages() %}
  {% if messages %}
    <div class="mb-6 space-y-3">
      {% for message in messages %}
        <div class="border-l-4 border-green-500 bg-gray-800 p-4 rounded text-green-300 text-sm">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
  {% endwith %}

  <!-- Article Card -->
  <article class="bg-gray-900 border border-gray-800 rounded-xl p-8 space-y-6">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center">
      <h1 class="text-3xl font-bold text-white">{{ article.title }}</h1>
      <div class="flex space-x-2 mt-4 sm:mt-0">
        {% if article.status == 'published' %}
        <span class="px-3 py-1 bg-green-700 text-green-100 text-xs rounded-full">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</span>
        {% else %}
        <span class="px-3 py-1 bg-yellow-700 text-yellow-100 text-xs rounded-full">–ß–µ—Ä–Ω–æ–≤–∏–∫</span>
        {% endif %}
        <span class="px-3 py-1 bg-blue-700 text-white text-xs rounded-full">{{ article.category }}</span>
      </div>
    </div>

    <!-- Article Image -->
    {% if article.articles_img %}
    <div class="w-full">
      <img src="{{ url_for('static', filename='uploads/articles/' + article.articles_img) }}"
          alt="{{ article.title }}"
          class="w-full h-64 sm:h-96 object-cover rounded-lg border border-gray-800">
    </div>
    {% endif %}

    <!-- Author Info -->
    <div class="flex items-center space-x-4 text-sm text-gray-400">
      <div class="flex items-center space-x-2">
        {% if article.author.avatar %}
        <img src="{{ url_for('static', filename='uploads/avatars/' + article.author.avatar) }}" 
             alt="{{ article.author.username }}" 
             class="w-8 h-8 rounded-full object-cover">
        {% else %}
        <div class="w-8 h-8 bg-gray-700 rounded-full flex items-center justify-center">
          <span class="text-white font-bold">{{ article.author.username[0].upper() }}</span>
        </div>
        {% endif %}
        <span>{{ article.author.username }}</span>
      </div>
      <span>‚Ä¢ {{ article.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
      {% if article.updated_at != article.created_at %}
      <span>‚Ä¢ –û–±–Ω–æ–≤–ª–µ–Ω–æ: {{ article.updated_at.strftime('%d.%m.%Y %H:%M') }}</span>
      {% endif %}
    </div>

    <!-- Tags -->
    {% if article.tags %}
    <div class="flex flex-wrap gap-2 text-sm">
      {% for tag in article.tags.split(',') %}
      {% if tag.strip() %}
      <span class="px-2 py-1 bg-gray-800 text-gray-300 rounded-full">#{{ tag.strip() }}</span>
      {% endif %}
      {% endfor %}
    </div>
    {% endif %}

    <!-- Content -->
    <div class="article-content text-gray-200 text-lg">
      {{ article.content|safe }}
    </div>

    <!-- Likes & Comments -->
    <div class="mt-8 border-t border-gray-800 pt-6 space-y-6">

      <!-- Likes -->
      {% if session.get('user_id') %}
      <form action="{{ url_for('like_article', id=article.id) }}" method="POST">
        {% set user_liked = article.likes|selectattr('user_id', 'equalto', session.get('user_id'))|list|length > 0 %}
        <button type="submit" class="px-4 py-2 {{ 'bg-red-600 hover:bg-red-700' if user_liked else 'bg-indigo-600 hover:bg-indigo-700' }} text-white rounded transition flex items-center space-x-2">
          <span>{{ '‚ù§Ô∏è' if user_liked else 'ü§ç' }} {{ article.likes|length }} {{ '–õ–∞–π–∫' if article.likes|length == 1 else '–õ–∞–π–∫–æ–≤' }}</span>
        </button>
      </form>
      {% else %}
      <div class="flex items-center space-x-2 text-gray-400">
        <span>ü§ç {{ article.likes|length }} {{ '–õ–∞–π–∫' if article.likes|length == 1 else '–õ–∞–π–∫–æ–≤' }}</span>
        <span class="text-sm">‚Ä¢ <a href="{{ url_for('sign_in_page') }}" class="text-indigo-400 hover:text-indigo-300 underline">–í–æ–π–¥–∏—Ç–µ</a> —á—Ç–æ–±—ã –ø–æ—Å—Ç–∞–≤–∏—Ç—å –ª–∞–π–∫</span>
      </div>
      {% endif %}

      <!-- Add Comment -->
      {% if session.get('user_id') %}
      <form action="{{ url_for('add_comment', id=article.id) }}" method="POST" class="space-y-3">
        <label for="content" class="block text-sm font-medium text-gray-300">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>
        <textarea name="content" 
                  id="content"
                  required
                  rows="3"
                  class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-gray-200 placeholder-gray-500 focus:outline-none focus:border-indigo-500 resize-y" 
                  placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..."></textarea>
        <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition">
          –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
        </button>
      </form>
      {% else %}
      <p class="text-gray-400 text-sm">
        –ß—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, 
        <a href="{{ url_for('sign_in_page') }}" class="text-indigo-400 hover:text-indigo-300 underline">–≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç</a>.
      </p>
      {% endif %}

      <!-- Comments List -->
      <div class="space-y-4">
        <h2 class="text-xl font-bold text-white">
          –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ article.comments|length }})
        </h2>
        {% if article.comments %}
          {% for comment in article.comments|sort(attribute='created_at', reverse=true) %}
          <div class="p-4 bg-gray-800 border border-gray-700 rounded-lg">
            <div class="flex justify-between items-start">
              <div class="flex items-center space-x-3 text-sm text-gray-400">
                {% if comment.user.avatar %}
                <img src="{{ url_for('static', filename='uploads/avatars/' + comment.user.avatar) }}" 
                     alt="{{ comment.user.username }}" 
                     class="w-6 h-6 rounded-full object-cover">
                {% else %}
                <div class="w-6 h-6 bg-gray-600 rounded-full flex items-center justify-center">
                  <span class="text-xs text-white font-bold">{{ comment.user.username[0].upper() }}</span>
                </div>
                {% endif %}
                <span class="font-medium text-gray-300">{{ comment.user.username }}</span>
                <span>‚Ä¢ {{ comment.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
              </div>
              {% if comment.user_id == session.get('user_id') %}
              <form action="{{ url_for('delete_comment', comment_id=comment.id) }}" method="POST" class="inline">
                <button type="submit" 
                        onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π?')"
                        class="text-red-500 hover:text-red-400 text-sm px-2 py-1 rounded hover:bg-red-900 hover:bg-opacity-20 transition">
                  –£–¥–∞–ª–∏—Ç—å
                </button>
              </form>
              {% endif %}
            </div>
            <p class="text-gray-200 mt-2 leading-relaxed">{{ comment.content }}</p>
          </div>
          {% endfor %}
        {% else %}
          <p class="text-gray-500 text-center py-8">–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
        {% endif %}
      </div>

    </div>

    <!-- Footer Buttons -->
    <div class="flex flex-col sm:flex-row justify-between items-center mt-6 space-y-4 sm:space-y-0 pt-6 border-t border-gray-800">
      <a href="{{ url_for('my_articles') }}" class="px-6 py-3 bg-gray-800 text-gray-300 rounded hover:bg-gray-700 transition">
        ‚Üê –í—Å–µ —Å—Ç–∞—Ç—å–∏
      </a>
      <div class="flex space-x-3">
        {% if session.get('user_id') == article.author_id %}
        <a href="{{ url_for('edit_article', id=article.id) }}" class="px-6 py-3 bg-yellow-600 text-white rounded hover:bg-yellow-700 transition">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
        <button onclick="confirmDelete()" class="px-6 py-3 bg-red-600 text-white rounded hover:bg-red-700 transition">–£–¥–∞–ª–∏—Ç—å</button>
        {% endif %}
        <a href="{{ url_for('create_article') }}" class="px-6 py-3 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition">–°–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—å—é</a>
      </div>
    </div>
  </article>

</main>

<!-- Delete Modal -->
<div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
  <div class="bg-gray-900 rounded-xl p-6 max-w-md w-full mx-4">
    <h3 class="text-xl font-bold text-white mb-4">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É–¥–∞–ª–µ–Ω–∏–µ</h3>
    <p class="text-gray-400 mb-6">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å—Ç–∞—Ç—å—é? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
    <div class="flex justify-end space-x-4">
      <button onclick="closeDeleteModal()" class="px-4 py-2 bg-gray-800 text-gray-300 rounded hover:bg-gray-700 transition">–û—Ç–º–µ–Ω–∞</button>
      <a href="{{ url_for('delete_article', id=article.id) }}" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition">–£–¥–∞–ª–∏—Ç—å</a>
    </div>
  </div>
</div>

<script>
function confirmDelete() {
  document.getElementById('deleteModal').classList.remove('hidden');
}
function closeDeleteModal() {
  document.getElementById('deleteModal').classList.add('hidden');
}
document.getElementById('deleteModal').addEventListener('click', function(e) {
  if(e.target === this) closeDeleteModal();
});
document.addEventListener('keydown', function(e) {
  if(e.key === 'Escape') closeDeleteModal();
});
</script>

</body>
</html>