<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{ article.title }} - NewsWrite Pro</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
  body { font-family: 'Roboto', sans-serif; }
  .article-content { line-height: 1.8; }
  .article-content p { margin-bottom: 1.5em; }
  .article-content h1, .article-content h2, .article-content h3 { font-weight: bold; margin: 1.5em 0 0.5em 0; }
  .article-content blockquote { border-left: 4px solid #6366f1; padding-left: 1.5em; font-style: italic; color: #9ca3af; margin: 1.5em 0; }
  .article-content a { color: #60a5fa; text-decoration: underline; }
  .article-content a:hover { color: #93c5fd; }
</style>
</head>
<body class="bg-gray-950 text-gray-200 min-h-screen flex flex-col">

<!-- Header -->
<header class="bg-gray-900 border-b border-gray-800">
  <div class="container mx-auto px-6 py-4 flex justify-between items-center">
    <a href="{{ url_for('home_page_logged') }}" class="text-xl font-bold text-indigo-400 hover:text-indigo-300">NewsWrite Pro</a>
    <div class="flex items-center space-x-4">
      <a href="{{ url_for('my_articles') }}" class="px-4 py-2 bg-gray-800 border border-gray-700 text-gray-300 rounded hover:border-indigo-500 hover:text-indigo-400 transition">← Все статьи</a>
      {% if session.get('user_id') == article.author_id %}
      <a href="{{ url_for('edit_article', id=article.id) }}" class="px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 transition">Редактировать</a>
      <button onclick="confirmDelete()" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition">Удалить</button>
      {% endif %}
    </div>
  </div>
</header>

<!-- Main content -->
<main class="flex-grow container mx-auto px-6 py-10 max-w-4xl">

  <!-- Flash messages -->
  {% with messages = get_flashed_messages() %}
  {% if messages %}
    <div class="mb-6 space-y-3">
      {% for message in messages %}
        <div class="border-l-4 border-green-500 bg-gray-800 p-4 rounded text-green-300 text-sm">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
  {% endwith %}

  <!-- Article Card -->
  <article class="bg-gray-900 border border-gray-800 rounded-xl p-8 space-y-6">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center">
      <h1 class="text-3xl font-bold text-white">{{ article.title }}</h1>
      <div class="flex space-x-2 mt-4 sm:mt-0">
        {% if article.status == 'published' %}
        <span class="px-3 py-1 bg-green-700 text-green-100 text-xs rounded-full">Опубликовано</span>
        {% else %}
        <span class="px-3 py-1 bg-yellow-700 text-yellow-100 text-xs rounded-full">Черновик</span>
        {% endif %}
        <span class="px-3 py-1 bg-blue-700 text-white text-xs rounded-full">{{ article.category }}</span>
      </div>
    </div>

    <!-- Author Info -->
    <div class="flex items-center space-x-4 text-sm text-gray-400">
      <div class="flex items-center space-x-2">
        <div class="w-8 h-8 bg-gray-700 rounded-full flex items-center justify-center">
          <span class="text-white font-bold">{{ article.author.username[0].upper() }}</span>
        </div>
        <span>{{ article.author.username }}</span>
      </div>
      <span>• {{ article.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
      {% if article.updated_at != article.created_at %}
      <span>• Обновлено: {{ article.updated_at.strftime('%d.%m.%Y %H:%M') }}</span>
      {% endif %}
    </div>

    <!-- Tags -->
    {% if article.tags %}
    <div class="flex flex-wrap gap-2 text-sm">
      {% for tag in article.tags.split(',') %}
      {% if tag.strip() %}
      <span class="px-2 py-1 bg-gray-800 text-gray-300 rounded-full">#{{ tag.strip() }}</span>
      {% endif %}
      {% endfor %}
    </div>
    {% endif %}

    <!-- Content -->
    <div class="article-content text-gray-200 text-lg">
      {{ article.content|safe }}
    </div>

    <!-- Likes and comments -->
<!-- Likes & Comments -->
<div class="mt-8 border-t border-gray-800 pt-6 space-y-6">

  <!-- Likes -->
  <form action="{{ url_for('like_article', id=article.id) }}" method="POST">
    <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition flex items-center space-x-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
      </svg>
      <span>❤️ {{ article.likes|length }} Лайков</span>
    </button>
  </form>

  <!-- Add Comment -->
  {% if session.get('user_id') %}
 <form action="{{ url_for('add_comment', id=article.id) }}" method="POST" class="mt-4">
    <textarea name="content" class="w-full p-2 rounded bg-gray-800 text-gray-200" placeholder="Ваш комментарий"></textarea>
    <button type="submit" class="mt-2 px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">Отправить</button>
</form>

  {% else %}
  <p class="text-gray-400 text-sm mt-2">Чтобы оставить комментарий, <a href="{{ url_for('sign_in_page') }}" class="text-indigo-400 hover:text-indigo-300 underline">войдите в аккаунт</a>.</p>
  {% endif %}

  <!-- Comments List -->
  <div class="mt-6 space-y-4">
    <h2 class="text-xl font-bold text-white">Комментарии ({{ article.comments|length }})</h2>
    {% for comment in article.comments %}
    <div class="p-4 bg-gray-800 rounded-lg">
      <div class="flex justify-between items-center text-sm text-gray-400">
        <span>{{ comment.user.username }} • {{ comment.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
        {% if comment.user_id == session.get('user_id') %}
        <form action="{{ url_for('delete_comment', comment_id=comment.id) }}" method="POST" class="inline">
          <button type="submit" class="text-red-500 hover:text-red-400 text-sm">Удалить</button>
        </form>
        {% endif %}
      </div>
      <p class="text-gray-200 mt-1">{{ comment.content }}</p>
    </div>
    {% endfor %}
  </div>

</div>
    <!-- Footer Buttons -->
    <div class="flex flex-col sm:flex-row justify-between items-center mt-6 space-y-4 sm:space-y-0">
      <a href="{{ url_for('my_articles') }}" class="px-6 py-3 bg-gray-800 text-gray-300 rounded hover:bg-gray-700 transition">Все статьи</a>
      <div class="flex space-x-3">
        {% if session.get('user_id') == article.author_id %}
        <a href="{{ url_for('edit_article', id=article.id) }}" class="px-6 py-3 bg-yellow-600 text-white rounded hover:bg-yellow-700 transition">Редактировать</a>
        <button onclick="confirmDelete()" class="px-6 py-3 bg-red-600 text-white rounded hover:bg-red-700 transition">Удалить</button>
        {% endif %}
        <a href="{{ url_for('create_article') }}" class="px-6 py-3 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition">Создать статью</a>
      </div>
    </div>
  </article>

</main>

<!-- Delete Modal -->
<div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
  <div class="bg-gray-900 rounded-xl p-6 max-w-md w-full">
    <h3 class="text-xl font-bold text-white mb-4">Подтвердите удаление</h3>
    <p class="text-gray-400 mb-6">Вы уверены, что хотите удалить эту статью? Это действие нельзя отменить.</p>
    <div class="flex justify-end space-x-4">
      <button onclick="closeDeleteModal()" class="px-4 py-2 bg-gray-800 text-gray-300 rounded hover:bg-gray-700 transition">Отмена</button>
      <a href="{{ url_for('delete_article', id=article.id) }}" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition">Удалить</a>
    </div>
  </div>
</div>

<script>
function confirmDelete() {
  document.getElementById('deleteModal').classList.remove('hidden');
}
function closeDeleteModal() {
  document.getElementById('deleteModal').classList.add('hidden');
}
document.getElementById('deleteModal').addEventListener('click', function(e) {
  if(e.target === this) closeDeleteModal();
});
document.addEventListener('keydown', function(e) {
  if(e.key === 'Escape') closeDeleteModal();
});
</script>

</body>
</html>
