<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Профиль пользователя - NewsWrite Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
    body { font-family: 'Roboto', sans-serif; }
  </style>
</head>
<body class="bg-gray-950 text-gray-200 min-h-screen flex flex-col">

  <!-- Navigation Header -->
  <header class="bg-gray-900 border-b border-gray-800">
    <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
      <a href="{{ url_for('home_page_logged') }}" class="text-xl font-bold text-indigo-400 hover:text-indigo-300">
        NewsWrite Pro
      </a>
      <div class="flex items-center space-x-4">
        <span class="text-sm text-gray-400">Здравствуйте, <span class="text-indigo-400 font-medium">{{ session.get('username', 'Пользователь') }}</span></span>
        <a href="{{ url_for('profile_page') }}" class="px-3 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition flex items-center space-x-1">
          <i class="fas fa-user"></i>
          <span class="text-sm">Профиль</span>
        </a>
        <a href="{{ url_for('logout') }}" class="px-4 py-2 bg-red-600 text-white text-sm rounded-lg hover:bg-red-700 transition">
          Выйти
        </a>
      </div>
    </nav>
  </header>

  <main class="flex-grow container mx-auto px-6 py-10">

    <!-- Flash messages -->
    {% with messages = get_flashed_messages() %}
    {% if messages %}
    <div class="mb-6 space-y-3">
      {% for message in messages %}
      <div class="border-l-4 border-green-500 bg-gray-800 p-4 rounded text-green-300 text-sm">
        {{ message }}
      </div>
      {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

      <!-- Left: Profile info & edit -->
      <div class="bg-gray-900 border border-gray-800 rounded-xl p-8 flex flex-col space-y-6">
        <h1 class="text-2xl font-bold text-white">Мой профиль</h1>

        <div class="space-y-3">
          <div>
            <p class="text-gray-400 text-sm">Имя пользователя</p>
            <p class="text-white font-medium">{{ session.get('username') }}</p>
          </div>
          <div>
            <p class="text-gray-400 text-sm">Email</p>
            <p class="text-white font-medium">{{ user.email if user else 'Не указан' }}</p>
          </div>
          <div>
            <p class="text-gray-400 text-sm">Возраст</p>
            <p class="text-white font-medium">{{ user.age if user else 'Не указан' }}</p>
          </div>
        </div>

        <hr class="border-gray-700">

        <h2 class="text-lg font-semibold text-white">Редактировать профиль</h2>
        <form action="{{ url_for('profile_page') }}" method="POST" class="space-y-4">
          <div>
            <label for="username" class="block text-gray-400 mb-1">Имя пользователя</label>
            <input type="text" id="username" name="username" value="{{ session.get('username') }}"
                   class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-indigo-500">
          </div>
          <div>
            <label for="email" class="block text-gray-400 mb-1">Email</label>
            <input type="email" id="email" name="email" value="{{ user.email if user else '' }}"
                   class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-indigo-500">
          </div>
          <div>
            <label for="age" class="block text-gray-400 mb-1">Возраст</label>
            <input type="number" id="age" name="age" value="{{ user.age if user else '' }}"
                   class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-indigo-500">
          </div>
          <button type="submit" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
            Сохранить изменения
          </button>
        </form>
      </div>

      <!-- Right: Statistics & articles -->
      <div class="lg:col-span-2 flex flex-col space-y-6">

        <!-- User stats -->
        <div class="bg-gray-900 border border-gray-800 rounded-xl p-6 flex flex-wrap justify-between gap-4">
          <div class="flex-1 min-w-[150px] bg-gray-800 p-4 rounded-lg text-center">
            <p class="text-gray-400 text-sm">Всего статей</p>
            <p class="text-white font-bold text-xl">{{ stats.total_articles }}</p>
          </div>
          <div class="flex-1 min-w-[150px] bg-gray-800 p-4 rounded-lg text-center">
            <p class="text-gray-400 text-sm">Опубликовано</p>
            <p class="text-white font-bold text-xl">{{ stats.published_articles }}</p>
          </div>
          <div class="flex-1 min-w-[150px] bg-gray-800 p-4 rounded-lg text-center">
            <p class="text-gray-400 text-sm">Черновики</p>
            <p class="text-white font-bold text-xl">{{ stats.draft_articles }}</p>
          </div>
          <div class="flex-1 min-w-[150px] bg-gray-800 p-4 rounded-lg text-center">
            <p class="text-gray-400 text-sm">Просмотры</p>
            <p class="text-white font-bold text-xl">{{ stats.total_views }}</p>
          </div>
        </div>

        <!-- Recent articles -->
        <div class="bg-gray-900 border border-gray-800 rounded-xl p-6">
          <h2 class="text-xl font-bold text-white mb-4">Мои последние статьи</h2>
          {% if recent_articles %}
            <div class="space-y-4">
              {% for article in recent_articles %}
              <div class="bg-gray-800 p-4 rounded-lg flex justify-between items-start border border-gray-700 hover:border-indigo-500 transition">
                <div>
                  <a href="{{ url_for('view_article', id=article.id) }}" class="text-white font-medium hover:text-indigo-400">{{ article.title }}</a>
                  <p class="text-gray-400 text-sm">{{ article.created_at.strftime('%d.%m.%Y %H:%M') }}</p>
                </div>
                <div class="flex flex-col space-y-1 text-right">
                  {% if article.status == 'published' %}
                  <span class="text-xs px-2 py-1 bg-green-700 text-green-100 rounded">Опубликовано</span>
                  {% else %}
                  <span class="text-xs px-2 py-1 bg-yellow-700 text-yellow-100 rounded">Черновик</span>
                  {% endif %}
                  <a href="{{ url_for('edit_article', id=article.id) }}" class="text-indigo-400 text-xs hover:underline">Редактировать</a>
                </div>
              </div>
              {% endfor %}
            </div>
          {% else %}
            <p class="text-gray-400 text-sm">У вас пока нет статей.</p>
          {% endif %}
        </div>

        <!-- Optional: Recent activities or notes -->
        <div class="bg-gray-900 border border-gray-800 rounded-xl p-6">
          <h2 class="text-xl font-bold text-white mb-4">Недавние действия</h2>
          {% if recent_activities %}
            <ul class="space-y-2 text-gray-400 text-sm">
              {% for activity in recent_activities %}
                <li>• {{ activity.description }} ({{ activity.created_at.strftime('%d.%m.%Y %H:%M') }})</li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-gray-400 text-sm">Действий пока нет.</p>
          {% endif %}
        </div>

      </div>
    </div>
  </main>

  <footer class="bg-gray-900 border-t border-gray-800 mt-auto">
    <div class="container mx-auto px-6 py-4 text-center text-gray-500 text-xs">
      &copy; 2025 NewsWrite Pro. Все права защищены.
    </div>
  </footer>

  <script src="https://kit.fontawesome.com/a2d9d6c53b.js" crossorigin="anonymous"></script>
</body>
</html>
